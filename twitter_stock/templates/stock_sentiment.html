{% load static from staticfiles %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/c3.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/stock_sentiment.css' %}">

    <title>APP NAME | Stock Sentiment</title>
</head>

<body>
    <div id="load-screen"></div>

    <div id="nav">APP NAME</div>

    <div id="chart-container">
        <div class="row">
            <div class="col-md-12"></div>
        </div>

        <div class="row dateselector">
            <div class="col-sm-12 center">
                <form class="row form-inline" name="rangeform"></form>
            </div>
        </div>

        <div class="row chart">
            <div class="col-md-12">
                <figure>
                    <div id="chart"></div>
                </figure>
            </div>
        </div>
    </div><!-- /chart-container -->

    <div id="output-text-container">
        <p id="universe">Universe on {{ current_date }}: {{ symbol_scores|length }} stock{{ symbol_scores|pluralize }}.</p>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js'></script>

    <script>
        'use strict';

        //global vars
        var SYMBOLS = {{ symbols|safe }}, 
            SCORES  = {{ scores |safe }};

        //store the data index of the selected symbol if it exists for a particular date; otherwise, notify the user
        (function(callback) {

            for(var i=0; i<SYMBOLS.length; i++) { if(sessionStorage.SYMBOL === SYMBOLS[i]) { sessionStorage.DATA_INDEX = i } }

            callback = function() {

                if(!sessionStorage.DATA_INDEX) {

                    var notif = document.createElement('p');

                    notif.style.textAlign = "center";
                    document.getElementById("output-text-container").appendChild(notif);

                    //basic error handling
                    if(sessionStorage.SYMBOL) {

                        notif.appendChild(document.createTextNode('Sorry, no results on this date for symbol '+sessionStorage.SYMBOL+'.'));
                    } else {
                        notif.appendChild(document.createTextNode('Please select a symbol before loading this page.'));
                    }
                }
            }();
        }());

        //test
        console.log(SYMBOLS, SCORES);
    </script>

    <script src='{% static "js/plotting.js" %}'></script>

    <script>window.onload = function() { document.getElementById("load-screen").style.display = "none" }</script>
</body>
